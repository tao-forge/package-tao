
TAO_MATCHING=typeof TAO_MATCHING!='undefined'?TAO_MATCHING:{};TAO_MATCHING.Matching=function(pData,pOptions){var data={"outcomes":null,"corrects":null,"maps":null,"rule":null};if(typeof(pData)!='undefined')$.extend(data,pData);var options={"evaluateCallback":null};if(typeof(pOptions)!='undefined')$.extend(options,pOptions);this.DEBUG_MODE=false;this.corrects=[];this.maps=[];this.outcomes=[];this.responses=[];this.rule='';this.options=options;this.whiteFunctionsList={'and':{'mappedFunction':'andExpression'},'createVariable':{},'console':{},'divide':{},'equal':{},'if':{'jsFunction':true},'isNull':{},'getCorrect':{},'getMap':{},'getResponse':{},'gt':{},'gte':{},'integerDivide':{},'lt':{},'lte':{},'mapResponse':{},'match':{},'not':{},'or':{},'product':{},'round':{},'setOutcomeValue':{},'subtract':{},'sum':{}};if(data.corrects!=null){this.setCorrects(data.corrects);}
if(data.outcomes!=null){this.setOutcomes(data.outcomes);}
if(data.maps!=null){this.setMaps(data.maps);}
if(data.rule!=null){this.setRule(data.rule);}}
TAO_MATCHING.Matching.prototype={debugTrace:function(fctName){var fctArguments=[];var paramCount=this.debugTrace.arguments.length;for(var i=1;i<paramCount;i++){fctArguments.push(this.debugTrace.arguments[i]);}
console.log('TRACE');console.log(fctName);console.log(fctArguments);return this[fctName].apply(this,fctArguments);},checkOptions:function(options){if(typeof options=='string')options=eval('('+options+')');else if(options==null)options={};return options;},console:function(options,obj){console.log(obj);return true;},evaluate:function()
{if(this.getRule()==null){throw new Error('TAO_MATCHING.Matching::evaluate : an error occured : the rule has not been defined');}
with(this){try{eval(getRule());}catch(e){if(this.DEBUG_MODE){console.log(e);}}}
if(this.options.evaluateCallback!=null){this.options.evaluateCallback(this.outcomes);}},getRule:function()
{return this.rule;},outcomesToJSON:function()
{var returnValue=Array();for(var key in this.outcomes){returnValue[key]=[];returnValue[key]["identifier"]=key;returnValue[key]["value"]=this.outcomes[key].toJSon();}
return returnValue;},setCorrects:function(data)
{if(!$.isArray(data))
throw new Error('TAO_MATCHING.Matching::setCorrects is waiting on an array, a '+(typeof data)+' is given');for(var key in data){try{if(typeof this.corrects[data[key].identifier]!='undefined')
throw new Error('TAO_MATCHING.Matching::setCorrects a correct variable with the identifier '+data[key].identifier+' exists yet');var matchingVar=TAO_MATCHING.VariableFactory.create(data[key].value);this.corrects[data[key].identifier]=matchingVar;}
catch(e){throw e;}}},setMaps:function(data)
{if(!$.isArray(data))
throw new Error('TAO_MATCHING.Matching::setMaps is waiting on an array, a '+(typeof data)+' is given');for(var key in data){try{if(typeof this.maps[data[key].identifier]!='undefined')
throw new Error('TAO_MATCHING.Matching::setMaps a correct variable with the identifier '+data[key].identifier+' exists yet');var matchingVar=new TAO_MATCHING.Map(data[key].value);this.maps[data[key].identifier]=matchingVar;}
catch(e){throw e;}}},setOutcomes:function(data)
{if(!$.isArray(data))
throw new Error('TAO_MATCHING.Matching::setOutcomes is waiting on an array, a '+(typeof data)+' is given');for(var key in data){try{if(typeof this.outcomes[data[key].identifier]!='undefined')
throw new Error('TAO_MATCHING.Matching::setOutcomes a correct variable with the identifier '+data[key].identifier+' exists yet');var outcomeDefaultValue=typeof(data[key].value)!='undefined'?data[key].value:null;var matchingVar=TAO_MATCHING.VariableFactory.create(outcomeDefaultValue);this.outcomes[data[key].identifier]=matchingVar;}
catch(e){throw e;}}},setResponses:function(data)
{if(!$.isArray(data))
throw new Error('TAO_MATCHING.Matching::setResponses is waiting on an array, a '+(typeof data)+' is given');for(var key in data){try{if(typeof this.responses[data[key].identifier]!='undefined')
throw new Error('TAO_MATCHING.Matching::setResponses a response variable with the identifier '+data[key].identifier+' exists yet');var matchingVar=TAO_MATCHING.VariableFactory.create(data[key].value);this.responses[data[key].identifier]=matchingVar;}
catch(e){throw e;}}},setRule:function(rule)
{var whiteFunctionsList=this.whiteFunctionsList;var self=this;var rule=rule.replace(/([a-zA-Z_\-1-9]*)[\s]*\(/g,function(str,funcName){if(typeof(whiteFunctionsList[funcName])=='undefined'){throw new Error('TAO_MATCHING.Matching::setRule an error occured, the expression ['+funcName+'] is unknown ');}
else if(typeof self[funcName]=='undefined'){if(typeof whiteFunctionsList[funcName]['mappedFunction']!='undefined'){if(typeof self[whiteFunctionsList[funcName]['mappedFunction']]=='undefined'){throw new Error('TAO_MATCHING.Matching::setRule an error occured, the expression ['+funcName+'] has been mapped to ['+whiteFunctionsList[funcName]['mappedFunction']+'] but is not yet instantiated');}
funcName=whiteFunctionsList[funcName]['mappedFunction'];}
else if(typeof whiteFunctionsList[funcName]['jsFunction']=='undefined'){throw new Error('TAO_MATCHING.Matching::setRule an error occured, the expression ['+funcName+'] is not yet instantiated');}}
if(self.DEBUG_MODE&&typeof whiteFunctionsList[funcName]['jsFunction']=='undefined'){return'debugTrace ("'+funcName+'" ,';}else{return funcName+'(';}});this.rule=rule;},createVariable:function(options,type){var returnValue=null;options=this.checkOptions(options);if(typeof(options.type)=='undefined'){returnValue=TAO_MATCHING.VariableFactory.create(this.createVariable.arguments[1]);}
else
{switch(options.type){case'integer':case'float':case'string':case'boolean':returnValue=TAO_MATCHING.VariableFactory.create(this.createVariable.arguments[1]);break;case'tuple':var values={};var a=0;for(var i=1;i<this.createVariable.arguments.length;++i,++a){values[a]=this.createVariable.arguments[i];}
returnValue=TAO_MATCHING.VariableFactory.create(values);break;case'list':var values=[];var a=0;for(var i=1;i<this.createVariable.arguments.length;++i,++a){values.push(this.createVariable.arguments[i]);}
returnValue=TAO_MATCHING.VariableFactory.create(values);break;case'default':throw new Error('TAO_MATCHING.createVariable : type unknown ['+options.type+']');}}
return returnValue;},setOutcomeValue:function(identifier,value)
{var outcome=this.getOutcome(identifier);if(outcome==null){throw new Error('TAO_MATCHING.Matching::setOutcomeValue error : the outcome value '+identifier+' does not exist');}
if(value instanceof TAO_MATCHING.BaseTypeVariable){outcome.setValue(value.getValue());}
else{outcome.setValue(value);}},getCorrect:function(identifier)
{var returnValue=null;if(typeof(this.corrects[identifier])!='undefined')
returnValue=this.corrects[identifier];else
throw new Error('TAO_MATCHING.Matching::getCorrect error : try to reach an unknown correct variable ['+identifier+']');return returnValue;},getMap:function(identifier)
{var returnValue=null;if(typeof(this.maps[identifier])!='undefined')
returnValue=this.maps[identifier];else
throw new Error('TAO_MATCHING.Matching::getMap error : try to reach an unknown mapping variable ['+identifier+']');return returnValue;},getOutcome:function(identifier)
{var returnValue=null;if(typeof(this.outcomes[identifier])!='undefined')
returnValue=this.outcomes[identifier];else
throw new Error('TAO_MATCHING.Matching::getOutcome error : try to reach an unknown outcome variable ['+identifier+']');return returnValue;},getResponse:function(identifier)
{var returnValue=null;if(typeof(this.responses[identifier])!='undefined')
returnValue=this.responses[identifier];else
throw new Error('TAO_MATCHING.Matching::getResponse error : try to reach an unknown outcome variable ['+identifier+']');return returnValue;},and:function(options){var returnValue=null;options=this.checkOptions(options);var paramCount=this.and.arguments.length;for(var i=1;i<paramCount;i++){var subExp=this.and.arguments[i];var matchingSubExp=TAO_MATCHING.VariableFactory.toBooleanBaseType(subExp);if(matchingSubExp==null){throw new Error("TtaoItems_models_classes_Matching_Matching::and an error occured : The ["+i+"]expression passed ["+matchingSubExp+"] to the operator has to be a valid boolean expression with single cardinality");}else{if(matchingSubExp.isNull()){returnValue=null;break;}else{if(returnValue===null){returnValue=matchingSubExp.getValue();}else{returnValue=returnValue&&matchingSubExp.getValue();}}}}
return returnValue;},equal:function(options,expr1,expr2){var result=null;options=this.checkOptions(options);var value1=null;var value2=null;if(expr1 instanceof TAO_MATCHING.BaseTypeVariable){value1=expr1.getValue();}
else{if(!TAO_MATCHING.Variable.is_scalar(expr1)){throw new Error('TAO_MATCHING.matching::equal an error occured : the first argument ['+expr1+'] must be a scalar');}
else{value1=expr1;}}
if(expr2 instanceof TAO_MATCHING.BaseTypeVariable){value2=expr2.getValue();}
else{if(!TAO_MATCHING.Variable.is_scalar(expr2)){throw new Error('TAO_MATCHING.matching::equal an error occured : the second argument ['+expr2+'] must be a scalar');}
else{value2=expr2;}}
if(value1!=null&&value2!=null){result=value1===value2;}
return result;},isNull:function(options,matchingVar)
{options=this.checkOptions(options);return matchingVar.isNull();},mapResponse:function(options,mappingVar,matchingVar)
{options=this.checkOptions(options);if(!(mappingVar instanceof TAO_MATCHING.Map))
throw new Error('TAO_MATCHING.Matching::mapResponse an error occured : first argument expected type TAO_MATCHING.mappingVar, given : '+(typeof mappingVar));return mappingVar.map(matchingVar);},match:function(options,expr1,expr2)
{var returnValue=false;options=this.checkOptions(options);if(typeof(expr1)=='undefined')
throw new Exception("TAO_MATCHING.Matching::match error : the first argument does not exist");if(typeof(expr2)=='undefined')
throw new Exception("TAO_MATCHING.Matching::match error : the second argument does not exist");if(expr1.getType()!=expr2.getType()){returnValue=false;}else{returnValue=expr1.match(expr2);}
return returnValue;},gt:function(options,expr1,expr2)
{var returnValue=false;var matchingExpr1=TAO_MATCHING.VariableFactory.toNumericBaseType(expr1);if(matchingExpr1==null){throw new Error("TAO_MATCHING.Matching::gt an error occured : The first expression passed ["+expr1+"] to the operator has to be a valid numerical expression with single cardinality");}
var matchingExpr2=TAO_MATCHING.VariableFactory.toNumericBaseType(expr2);if(matchingExpr2==null){throw new Error("TAO_MATCHING.Matching::gt an error occured : The second expression passed ["+expr2+"] to the operator has to be a valid numerical expression with single cardinality");}
if(matchingExpr1.getValue()>matchingExpr2.getValue()){returnValue=true;}
return returnValue;},lt:function(options,expr1,expr2)
{var returnValue=false;var matchingExpr1=TAO_MATCHING.VariableFactory.toNumericBaseType(expr1);if(matchingExpr1==null){throw new Error("TAO_MATCHING.Matching::gt an error occured : The first expression passed ["+expr1+"] to the operator has to be a valid numerical expression with single cardinality");}
var matchingExpr2=TAO_MATCHING.VariableFactory.toNumericBaseType(expr2);if(matchingExpr2==null){throw new Error("TAO_MATCHING.Matching::gt an error occured : The second expression passed ["+expr2+"] to the operator has to be a valid numerical expression with single cardinality");}
if(matchingExpr1.getValue()<matchingExpr2.getValue()){returnValue=true;}
return returnValue;},lte:function(options,expr1,expr2)
{var returnValue=false;var matchingExpr1=TAO_MATCHING.VariableFactory.toNumericBaseType(expr1);if(matchingExpr1==null){throw new Error("TAO_MATCHING.Matching::gt an error occured : The first expression passed ["+expr1+"] to the operator has to be a valid numerical expression with single cardinality");}
var matchingExpr2=TAO_MATCHING.VariableFactory.toNumericBaseType(expr2);if(matchingExpr2==null){throw new Error("TAO_MATCHING.Matching::gt an error occured : The second expression passed ["+expr2+"] to the operator has to be a valid numerical expression with single cardinality");}
if(matchingExpr1.getValue()<=matchingExpr2.getValue()){returnValue=true;}
return returnValue;},gte:function(options,expr1,expr2)
{var returnValue=false;var matchingExpr1=TAO_MATCHING.VariableFactory.toNumericBaseType(expr1);if(matchingExpr1==null){throw new Error("TAO_MATCHING.Matching::gt an error occured : The first expression passed ["+expr1+"] to the operator has to be a valid numerical expression with single cardinality");}
var matchingExpr2=TAO_MATCHING.VariableFactory.toNumericBaseType(expr2);if(matchingExpr2==null){throw new Error("TAO_MATCHING.Matching::gt an error occured : The second expression passed ["+expr2+"] to the operator has to be a valid numerical expression with single cardinality");}
if(matchingExpr1.getValue()>=matchingExpr2.getValue()){returnValue=true;}
return returnValue;},sum:function(options){var returnValue=0;options=this.checkOptions(options);var paramCount=this.sum.arguments.length;for(var i=1;i<paramCount;i++){var subExp=this.sum.arguments[i];var matchingSubExp=TAO_MATCHING.VariableFactory.toNumericBaseType(subExp);if(matchingSubExp==null){throw new Error("TAO_MATCHING.Matching::sum an error occured : The ["+i+"] expression passed ["+subExp+"] to the operator has to be a valid numerical expression with single cardinality");}else if(matchingSubExp.isNull()){returnValue=null;break;}else{returnValue+=matchingSubExp.getValue();}}
return returnValue;},subtract:function(options,expr1,expr2){var returnValue=null;var matchingExpr1=TAO_MATCHING.VariableFactory.toNumericBaseType(expr1);if(matchingExpr1==null){throw new Error("TAO_MATCHING.Matching::substract an error occured : The first expression passed ["+expr1+"] to the operator has to be a valid numerical expression with single cardinality");}
var matchingExpr2=TAO_MATCHING.VariableFactory.toNumericBaseType(expr2);if(matchingExpr2==null){throw new Error("TAO_MATCHING.Matching::substract an error occured : The second expression passed ["+expr2+"] to the operator has to be a valid numerical expression with single cardinality");}
if(matchingExpr1.getValue()==null||matchingExpr2.getValue()==null){returnValue=null;}else{returnValue=matchingExpr1.getValue()-matchingExpr2.getValue();}
return returnValue;},product:function(options){var returnValue=null;options=this.checkOptions(options);var paramCount=this.product.arguments.length;for(var i=1;i<paramCount;i++){var subExp=this.product.arguments[i];var matchingSubExp=TAO_MATCHING.VariableFactory.toNumericBaseType(subExp);if(matchingSubExp==null){throw new Error("TAO_MATCHING.Matching::product an error occured : The ["+i+"] expression passed ["+subExp+"] to the operator has to be a valid numerical expression with single cardinality");}
else if(matchingSubExp.isNull()){returnValue=null;break;}else{if(returnValue==null){returnValue=matchingSubExp.getValue();}
else{returnValue*=matchingSubExp.getValue();}}}
return returnValue;},divide:function(options,expr1,expr2){var returnValue=null;var matchingExpr1=TAO_MATCHING.VariableFactory.toNumericBaseType(expr1);if(matchingExpr1==null){throw new Error("TAO_MATCHING.Matching::substract an error occured : The first expression passed ["+expr1+"] to the operator has to be a valid numerical expression with single cardinality");}
var matchingExpr2=TAO_MATCHING.VariableFactory.toNumericBaseType(expr2);if(matchingExpr2==null){throw new Error("TAO_MATCHING.Matching::substract an error occured : The second expression passed ["+expr2+"] to the operator has to be a valid numerical expression with single cardinality");}
if(matchingExpr1.getValue()==null||matchingExpr2.getValue()==null||matchingExpr2.getValue()==0){returnValue=null;}else{returnValue=matchingExpr1.getValue()/matchingExpr2.getValue();}
return returnValue;},round:function(options,expr){var returnValue=null;options=this.checkOptions(options);if(expr==null){returnValue=null;}else{var matchingExpr=TAO_MATCHING.VariableFactory.toNumericBaseType(expr);if(matchingExpr==null){throw new Error("TAO_MATCHING.Matching::round an error occured : The expression passed ["+expr+"] to the operator has to be a valid numerical expression with single cardinality");}else{if(matchingExpr.isNull()){returnValue=null;}else{var precision=0;if(typeof options.precision!='undefined'){precision=options.precision;}
returnValue=Math.round(matchingExpr.getValue()*Math.pow(10,precision))/Math.pow(10,precision);}}}
return returnValue;},integerDivide:function(options,expr1,expr2){var returnValue=null;returnValue=this.round(null,this.divide(null,expr1,expr2));return returnValue;},not:function(options,expr)
{var returnValue=null;var matchingExpr=TAO_MATCHING.VariableFactory.toBooleanBaseType(expr);if(matchingExpr==null){throw new Error("TtaoItems_models_classes_Matching_Matching::not an error occured : The expression passed ["+expr+"] to the operator has to be a valid boolean expression with single cardinality");}else{var matchingExprValue=matchingExpr.getValue();if(matchingExprValue!=null){returnValue=!matchingExprValue;}}
return returnValue;},or:function(options){var returnValue=null;options=this.checkOptions(options);var paramCount=this.or.arguments.length;for(var i=1;i<paramCount;i++){var subExp=this.or.arguments[i];var matchingSubExp=TAO_MATCHING.VariableFactory.toBooleanBaseType(subExp);if(matchingSubExp==null){throw new Error("TtaoItems_models_classes_Matching_Matching::or an error occured : The ["+i+"]expression passed ["+matchingSubExp+"] to the operator has to be a valid boolean expression with single cardinality");}else{if(matchingSubExp.isNull()){returnValue=null;break;}else{if(returnValue===null){returnValue=matchingSubExp.getValue();}else{returnValue=returnValue||matchingSubExp.getValue();}}}}
return returnValue;}};
TAO_MATCHING=typeof TAO_MATCHING!='undefined'?TAO_MATCHING:{};TAO_MATCHING.MatchingRemote=function(url,params,pOptions){var options={"evaluateCallback":null};if(typeof(pOptions)!='undefined')$.extend(options,pOptions);this.outcomes=[];this.responses=[];this.url=url;this.params=params;this.options=options;}
TAO_MATCHING.MatchingRemote.prototype={evaluate:function()
{var self=this;var responses=this.responses;var requestParams=$.extend({},this.params,{data:JSON.stringify(this.responses)});$.ajax({url:this.url,type:'POST',async:true,dataType:'json',data:requestParams,success:function(data){self.outcomes=data;if(self.options.evaluateCallback!=null){self.options.evaluateCallback(data);}}});},outcomesToJSON:function()
{return this.outcomes;},setResponses:function(data)
{if(!$.isArray(data))
throw new Error('TAO_MATCHING.Matching::setResponses is waiting on an array, a '+(typeof data)+' is given');this.responses=data;}};
TAO_MATCHING=typeof TAO_MATCHING!='undefined'?TAO_MATCHING:{};TAO_MATCHING.VariableFactory={create:function(data,pType){var returnValue=null;var type=null;if(typeof pType!='undefined'&&pType!=null){type=pType;}
else{type=TAO_MATCHING.VariableFactory.getType(data);}
switch(type){case'tuple':returnValue=new TAO_MATCHING.Tuple(data);break;case'list':returnValue=new TAO_MATCHING.List(data);break;case'boolean':case'number':case'string':case'NULL':returnValue=new TAO_MATCHING.BaseTypeVariable(data);break;default:throw new Error('TAO_MATCHING.VariableFactory::create variable type unknown '+type+' for '+data);}
return returnValue;},getType:function(data){var returnValue=null;if(typeof data=='object'){if(data==null){returnValue='NULL';}
else if(($.isArray(data))){returnValue='list';}
else{returnValue='tuple';}}
else{returnValue=typeof data;}
return returnValue;},isMatchingVariable:function(data){var returnValue=false;if(data instanceof TAO_MATCHING.BaseTypeVariable||data instanceof TAO_MATCHING.Tuple||data instanceof TAO_MATCHING.List)
{returnValue=true;}
return returnValue;},toNumericBaseType:function(data){var returnValue=null;if(!(data instanceof TAO_MATCHING.BaseTypeVariable)){if(TAO_MATCHING.BaseTypeVariable.isValidValue(data)){var matchingVar=new TAO_MATCHING.BaseTypeVariable(data);if(matchingVar.isNumerical()){returnValue=matchingVar;}}}else{if(data.isNumerical()){returnValue=data;}}
return returnValue;},toBooleanBaseType:function(data){var returnValue=null;if(!(data instanceof TAO_MATCHING.BaseTypeVariable)){if(TAO_MATCHING.BaseTypeVariable.isValidValue(data)){var matchingVar=new TAO_MATCHING.BaseTypeVariable(data);if(matchingVar.isBoolean()){returnValue=matchingVar;}}}else{if(data.isBoolean()){returnValue=data;}}
return returnValue;}}
TAO_MATCHING=typeof TAO_MATCHING!='undefined'?TAO_MATCHING:{};TAO_MATCHING.Variable=function(){this.value=null;};TAO_MATCHING.Variable.prototype={getType:function()
{},getValue:function()
{return this.value;},equal:function(matchingVar)
{},isNull:function()
{},match:function(matchingVar)
{},setValue:function(data)
{},toJSon:function(){}};TAO_MATCHING.Variable.is_scalar=function(data){var returnValue=false;switch(typeof data){case"boolean":case"number":case"string":returnValue=true;}
return returnValue;};
TAO_MATCHING=typeof TAO_MATCHING!='undefined'?TAO_MATCHING:{};TAO_MATCHING.BaseTypeVariable=function(data){TAO_MATCHING.Variable.call(this);this.setValue(data);}
TAO_MATCHING.BaseTypeVariable.prototype={getType:function()
{return(typeof this.value);},equal:function(matchingVar)
{if(!(matchingVar instanceof TAO_MATCHING.BaseTypeVariable))
throw new Error('TAO_MATCHING.BaseTypeVariable.equal an error occured : first argument expected type TAO_MATCHING.BaseTypeVariable, given : '+(typeof matchingVar));var returnValue=false;if(this.getType()!=matchingVar.getType()){returnValue=false;}else{returnValue=(this.getValue()==matchingVar.getValue());}
return returnValue;},isNull:function()
{return(this.value==null);},match:function(matchingVar)
{if(!(matchingVar instanceof TAO_MATCHING.BaseTypeVariable))
throw new Error('TAO_MATCHING.BaseTypeVariable.match an error occured : first argument expected type TAO_MATCHING.BaseTypeVariable, given : '+(typeof matchingVar));return this.equal(matchingVar);},setValue:function(data)
{this.value=data;},toJSon:function()
{return this.getValue();},isNumerical:function()
{var returnValue=false;if(this.getValue()==null){returnValue=true;}else{switch(this.getType()){case'number':returnValue=true;}}
return returnValue;},isBoolean:function()
{var returnValue=false;if(this.getValue()==null){returnValue=true;}else{switch(this.getType()){case'boolean':returnValue=true;}}
return returnValue;}};TAO_MATCHING.BaseTypeVariable.isValidValue=function(data)
{var returnValue=false;if(data==null){returnValue=true;}
else{switch(typeof(data)){case'boolean':case'number':case'string':returnValue=true;}}
return returnValue;};TAO_MATCHING.BaseTypeVariable.prototype=$.extend({},TAO_MATCHING.Variable.prototype,TAO_MATCHING.BaseTypeVariable.prototype);
TAO_MATCHING=typeof TAO_MATCHING!='undefined'?TAO_MATCHING:{};TAO_MATCHING.Collection=function(data){TAO_MATCHING.Variable.call(this);};TAO_MATCHING.Collection.prototype={contain:function(matchingVar)
{var returnValue=null;for(var key in this.value){if(matchingVar.getType()!=this.value[key].getType()){returnValue=null;break;}
if(matchingVar.match(this.value[key])){returnValue=key;break;}}
return returnValue;},isNull:function()
{if(this.value==null)
return true;if(this.value.length==0)
return true;return false;},length:function()
{if(this.isNull())
return 0;else
return this.value.length;}};TAO_MATCHING.Collection.prototype=$.extend({},TAO_MATCHING.Variable.prototype,TAO_MATCHING.Collection.prototype);
TAO_MATCHING=typeof TAO_MATCHING!='undefined'?TAO_MATCHING:{};TAO_MATCHING.List=function(data){TAO_MATCHING.Collection.call(this);this.setValue(data);};TAO_MATCHING.List.prototype={getType:function()
{return'list';},getElement:function(key)
{if(typeof this.value[key]!='undefined'){return this.value[key];}
return null;},match:function(list)
{if(!(list instanceof TAO_MATCHING.List))
throw new Error('TAO_MATCHING.List.match an error occured : first argument expected type TAO_MATCHING.List, given : '+(typeof list));var returnValue=true;if(this.length()!=list.length()){return false;}
for(var i=0;i<this.length();i++){var tempResult=false;for(var j=0;j<list.length();j++){if(this.getElement(i).getType()!=list.getElement(j).getType()){throw new Exception('TAO_MATCHING.List::match an error occured : types of the elements to match are not the same ['+this.getElement(i).getType()+'] and ['+list.getElement(j).getType()+']');returnValue=false;}
else if(this.getElement(i).match(list.getElement(j))){tempResult=true;break;}
else{}}
if(!tempResult){returnValue=false;break;}}
return returnValue;},setValue:function(data)
{this.value=[];for(var i in data){if(TAO_MATCHING.VariableFactory.isMatchingVariable(data[i])){this.value.push(data[i]);}
else{this.value.push(TAO_MATCHING.VariableFactory.create(data[i]));}}}};TAO_MATCHING.List.prototype=$.extend({},TAO_MATCHING.Collection.prototype,TAO_MATCHING.List.prototype);
TAO_MATCHING=typeof TAO_MATCHING!='undefined'?TAO_MATCHING:{};TAO_MATCHING.Tuple=function(data){TAO_MATCHING.Collection.call(this);this.setValue(data);};TAO_MATCHING.Tuple.prototype={getType:function()
{return'tuple';},getElement:function(key)
{if(typeof this.value[key]!='undefined'){return this.value[key];}
return null;},match:function(tuple)
{if(!(tuple instanceof TAO_MATCHING.Tuple))
throw new Error('TAO_MATCHING.Tuple.match an error occured : first argument expected type TAO_MATCHING.Tuple, given : '+(typeof matchingVar));var returnValue=true;if(this.length()!=tuple.length()){return false;}
for(var key in this.value){var compareElt=tuple.getElement(key);if(compareElt==null){returnValue=false;break;}else if(this.value[key].getType()!=compareElt.getType()){throw new Error('TAO_MATCHING.Tuple::match an error occured : types of the elements to match are not the same ['+elt.getType()+'] and ['+compareElt.getType()+']');returnValue=false;break;}else if(!this.value[key].match(compareElt)){returnValue=false;break;}else{returnValue=true;}}
return returnValue;},setValue:function(data)
{this.value=[];for(var key in data){if(TAO_MATCHING.VariableFactory.isMatchingVariable(data[key])){this.value[key]=data[key];}else{this.value[key]=TAO_MATCHING.VariableFactory.create(data[key]);}}}};TAO_MATCHING.Tuple.prototype=$.extend({},TAO_MATCHING.Collection.prototype,TAO_MATCHING.Tuple.prototype);
TAO_MATCHING=typeof TAO_MATCHING!='undefined'?TAO_MATCHING:{};TAO_MATCHING.Map=function(data){this.setValue(data);};TAO_MATCHING.Map.prototype={map:function(matchingVar){var returnValue=0.0;var mapKeyFound=[];for(var mapKey in this.value){if((matchingVar instanceof TAO_MATCHING.List)||(matchingVar instanceof TAO_MATCHING.Tuple)){if(matchingVar.contain(this.value[mapKey]['key'])!=null){returnValue+=this.value[mapKey]['value'];}}
else{if(matchingVar.match(this.value[mapKey]['key'])){returnValue+=this.value[mapKey]['value'];}}}
return returnValue;},setValue:function(data){this.value=[];for(var i in data){this.value.push({"value":data[i].value,"key":TAO_MATCHING.VariableFactory.create(data[i].key)});}}};
TAO_MATCHING=typeof TAO_MATCHING!='undefined'?TAO_MATCHING:{};TAO_MATCHING.RULE=typeof TAO_MATCHING.RULE!='undefined'?TAO_MATCHING.RULE:{};TAO_MATCHING.RULE.MATCH_CORRECT="if(match(null, getResponse('RESPONSE'), getCorrect('RESPONSE'))) setOutcomeValue('SCORE', 1); else setOutcomeValue('SCORE', 0);";TAO_MATCHING.RULE.MAP_RESPONSE="if(isNull(null, getResponse('RESPONSE'))) { setOutcomeValue('SCORE', 0); } else { setOutcomeValue('SCORE', mapResponse(null, getMap('RESPONSE'), getResponse('RESPONSE'))); }";
TAO_MATCHING=typeof TAO_MATCHING!='undefined'?TAO_MATCHING:{};TAO_MATCHING.engine=null;function matchingInit(pParams){var params={"url":null,"params":null,"data":null,"format":"json","options":null};if(typeof(pParams)!='undefined')$.extend(params,pParams);if(params.url!=null){TAO_MATCHING.engine=new TAO_MATCHING.MatchingRemote(params.url,params.params,params.options);}
else if(params.data!=null){TAO_MATCHING.engine=new TAO_MATCHING.Matching(params.data,params.options);}
else{throw new Error("matching_init an error occured : the options are not well formed, data or url have to be defined");}}
function matchingEvaluate(){TAO_MATCHING.engine.evaluate();}
function matchingGetOutcomes(){return TAO_MATCHING.engine.outcomesToJSON();}
function matching_setCorrects(data){TAO_MATCHING.engine.setCorrects(data);}
function matchingSetMaps(data){TAO_MATCHING.engine.setMaps(data);}
function matchingSetOutcomes(data){TAO_MATCHING.engine.setOutcomes(data);}
function matchingSetResponses(data){TAO_MATCHING.engine.setResponses(data);}
function matchingSetRule(rule){TAO_MATCHING.engine.setRule(rule);}