<!DOCTYPE html>
<html>
<head>
	<title>QUnit Test Suite</title>
	<link rel="stylesheet" href="../../tao/test/qunit/qunit.css" type="text/css" media="screen">
	<script type="application/javascript" src='http://waterphoenix.local/lib/jquery/jquery-1.4.2.min.js'></script>
	<script type="application/javascript" src='http://waterphoenix.local/src/lib/oo/class.js'></script>
	<script type="application/javascript" src="../../tao/test/qunit/qunit.js"></script>
	<script type="application/javascript" src="./qti_labs/client/qti_api.js"></script>
	
	<!-- -------------------------------------------------------------------------
	QTI DATA
	--------------------------------------------------------------------------->
	<script type="application/javascript">
		// Corrects vars defined through the responseDeclaration
		var outcomes = [];
		var outcomesSerialized ='[ \
			{"identifier":"SCORE5_1", "type":"float", "cardinality":"single", "values":[]} \
			, {"identifier":"SCORE5_2", "type":"float", "cardinality":"single", "values":[]} \
		]';
		outcomes = unserializedQTIVariables (outcomesSerialized);
		
		// Corrects vars defined through the responseDeclaration
		var corrects = [];
		var correctsSerialized = '[ \
			{"identifier":"RESPONSE0_1", "type":"identifier", "cardinality":"single", "values":["ID_1"]} \
			, {"identifier":"RESPONSE1_1", "type":"identifier", "cardinality":"multiple", "values":["ID_1", "ID_2", "ID_3"]} \
			, {"identifier":"RESPONSE1_2", "type":"identifier", "cardinality":"multiple", "values":["ID_1", "ID_2", "ID_3"]} \
			, {"identifier":"RESPONSE1_3", "type":"identifier", "cardinality":"multiple", "values":["ID_1", "ID_2", "ID_3"]} \
			, {"identifier":"RESPONSE1_4", "type":"identifier", "cardinality":"multiple", "values":["ID_1", "ID_2"]} \
			, {"identifier":"RESPONSE1_5", "type":"pair", "cardinality":"multiple", "values":[["A", "B"], ["C", "D"]]} \
			, {"identifier":"RESPONSE2_1", "type":"pair", "cardinality":"single", "values":[["A", "B"]]} \
			, {"identifier":"RESPONSE3_1", "type":"pair", "cardinality":"multiple", "values":[["A", "B"], ["C", "D"], ["E", "F"]]} \
			, {"identifier":"RESPONSE6_1", "type":"directedpair", "cardinality":"multiple", "values":[["A", "B"], ["C", "D"], ["E", "F"]]} \
			, {"identifier":"RESPONSE7_1", "type":"boolean", "cardinality":"multiple", "values":[true, false, true, false]} \
			, {"identifier":"RESPONSE8_1", "type":"integer", "cardinality":"multiple", "values":[1, 2, 3, 4]} \
			, {"identifier":"RESPONSE9_1", "type":"float", "cardinality":"multiple", "values":[1.1, 2.2, 3.3, 4.4]} \
			, {"identifier":"RESPONSE10_1", "type":"string", "cardinality":"multiple", "values":["abc", "def", "ghi", "klm"]} \
		]';
		corrects = unserializedQTIVariables (correctsSerialized);
		
		// Variables defined through user's interactions
		var variables = [];
		var variablesSerialized = "[ \
			{identifier:'RESPONSE0_1', type:'identifier', cardinality:'single', values:['ID_1']} \
			, {identifier:'RESPONSE0_2', type:'identifier', cardinality:'single', values:['ID_0']} \
			, {identifier:'RESPONSE0_3', type:'identifier', cardinality:'single', values:[]} \
			, {identifier:'RESPONSE1_1', type:'identifier', cardinality:'multiple', values:['ID_1', 'ID_3', 'ID_2']} \
			, {identifier:'RESPONSE1_2', type:'identifier', cardinality:'multiple', values:['ID_0', 'ID_1', 'ID_2']} \
			, {identifier:'RESPONSE1_3', type:'identifier', cardinality:'multiple', values:['ID_1', 'ID_2']} \
			, {identifier:'RESPONSE1_4', type:'identifier', cardinality:'multiple', values:['ID_1', 'ID_2', 'ID_3']} \
			, {identifier:'RESPONSE2_1', type:'pair', cardinality:'single', values:[['A', 'B']]} \
			, {identifier:'RESPONSE2_2', type:'pair', cardinality:'single', values:[['A', 'C']]} \
			, {identifier:'RESPONSE2_3', type:'pair', cardinality:'single', values:[]} \
			, {identifier:'RESPONSE2_4', type:'pair', cardinality:'single', values:[['B', 'A']]} \
			, {identifier:'RESPONSE3_1', type:'pair', cardinality:'multiple', values:[['A', 'B'], ['C', 'D'], ['E', 'F']]} \
			, {identifier:'RESPONSE3_2', type:'pair', cardinality:'multiple', values:[['A', 'B'], ['Z', 'D'], ['E', 'F']]} \
			, {identifier:'RESPONSE3_3', type:'pair', cardinality:'multiple', values:[['A', 'B'], ['Z', 'D']]} \
			, {identifier:'RESPONSE3_4', type:'pair', cardinality:'multiple', values:[['B', 'A'], ['D', 'C'], ['F', 'E']]} \
			, {identifier:'RESPONSE4_1', type:'pair', cardinality:'multiple', values:[['A', 'B'], ['C', 'D'], ['E', 'F']]} \
			, {identifier:'RESPONSE4_2', type:'pair', cardinality:'multiple', values:[['A', 'B'], ['C', 'D'], ['E', 'F'], ['A', 'B'], ['C', 'D'], ['E', 'F']]} \
			, {identifier:'RESPONSE4_3', type:'pair', cardinality:'multiple', values:[]} \
			, {identifier:'RESPONSE4_4', type:'pair', cardinality:'multiple', values:[['A', 'B'], ['C', 'D']]} \
			, {identifier:'RESPONSE4_5', type:'pair', cardinality:'multiple', values:[['B', 'A'], ['D', 'C'], ['F', 'E']]} \
			, {identifier:'RESPONSE6_1', type:'directedpair', cardinality:'multiple', values:[['B', 'A'], ['D', 'C'], ['F', 'E']]} \
			, {identifier:'RESPONSE6_2', type:'directedpair', cardinality:'multiple', values:[['A', 'B'], ['C', 'D'], ['E', 'F']]} \
			, {identifier:'RESPONSE7_1', type:'boolean', cardinality:'multiple', values:[true, false, true, false]} \
			, {identifier:'RESPONSE8_1', type:'integer', cardinality:'multiple', values:[1, 2, 3, 4]} \
			, {identifier:'RESPONSE9_1', type:'float', cardinality:'multiple', values:[1.1, 2.2, 3.3, 4.4]} \
			, {identifier:'RESPONSE10_1', type:'string', cardinality:'multiple', values:['abc', 'def', 'ghi', 'klm']} \
		]";
		variables = unserializedQTIVariables (variablesSerialized);
		
		// Mapping defined through the responseDeclaration
		var maps = [];
		var mapsSerialized = "[ \
			{identifier:'RESPONSE4_1', type:'pair', cardinality:'multiple', values:[[['A', 'B'], 1], [['C', 'D'], 0.5], [['E', 'F'], 0.1]]} \
		]";
		maps = unserializedQTIVariables (mapsSerialized, {containerType:'map'});
		
		// SET OF RULES
		var rules = [];
		
		rules['match0_1'] = "match(getVariable('RESPONSE0_1'), getCorrect('RESPONSE0_1'))";
		rules['match0_2'] = "match(getVariable('RESPONSE0_2'), getCorrect('RESPONSE0_1'))";
		rules['match0_3'] = "match(getVariable('RESPONSE0_3'), getCorrect('RESPONSE0_1'))";
		
		rules['match1_1'] = "match(getVariable('RESPONSE1_1'), getCorrect('RESPONSE1_1'))";
		rules['match1_2'] = "match(getVariable('RESPONSE1_2'), getCorrect('RESPONSE1_2'))";
		rules['match1_3'] = "match(getVariable('RESPONSE1_3'), getCorrect('RESPONSE1_3'))";
		rules['match1_4'] = "match(getVariable('RESPONSE1_4'), getCorrect('RESPONSE1_4'))";
		
		rules['match2_1'] = "match(getVariable('RESPONSE2_1'), getCorrect('RESPONSE2_1'))";
		rules['match2_2'] = "match(getVariable('RESPONSE2_2'), getCorrect('RESPONSE2_1'))";
		rules['match2_3'] = "match(getVariable('RESPONSE2_3'), getCorrect('RESPONSE2_1'))";
		rules['match2_4'] = "match(getVariable('RESPONSE2_4'), getCorrect('RESPONSE2_1'))";
		
		rules['match3_1'] = "match(getVariable('RESPONSE3_1'), getCorrect('RESPONSE3_1'))";
		rules['match3_2'] = "match(getVariable('RESPONSE3_2'), getCorrect('RESPONSE3_1'))";
		rules['match3_3'] = "match(getVariable('RESPONSE3_3'), getCorrect('RESPONSE3_1'))";
		rules['match3_4'] = "match(getVariable('RESPONSE3_4'), getCorrect('RESPONSE3_1'))";
		
		rules['map4_1'] = "mapResponse(getVariable('RESPONSE4_1'), getMap('RESPONSE4_1'))";
		rules['map4_2'] = "mapResponse(getVariable('RESPONSE4_2'), getMap('RESPONSE4_1'))";
		rules['map4_3'] = "mapResponse(getVariable('RESPONSE4_3'), getMap('RESPONSE4_1'))";
		rules['map4_4'] = "mapResponse(getVariable('RESPONSE4_4'), getMap('RESPONSE4_1'))";
		rules['map4_5'] = "mapResponse(getVariable('RESPONSE4_5'), getMap('RESPONSE4_1'))";
		
		rules['setoutcome5_1'] = "setOutcomeValue('SCORE5_1', [2])";
		rules['setoutcome5_2'] = "setOutcomeValue('SCORE5_2', ["+rules['map4_5']+"])";
		
		rules['match6_1'] = "match(getVariable('RESPONSE6_1'), getCorrect('RESPONSE6_1'))";
		rules['match6_2'] = "match(getVariable('RESPONSE6_2'), getCorrect('RESPONSE6_1'))";
		
		rules['match7_1'] = "match(getVariable('RESPONSE7_1'), getCorrect('RESPONSE7_1'))";
		
		rules['match8_1'] = "match(getVariable('RESPONSE8_1'), getCorrect('RESPONSE8_1'))";
		
		rules['match9_1'] = "match(getVariable('RESPONSE9_1'), getCorrect('RESPONSE9_1'))";
		
		rules['match10_1'] = "match(getVariable('RESPONSE10_1'), getCorrect('RESPONSE10_1'))";
		
		rules['and11_1'] = "and(true, true)";
		rules['and11_2'] = "and("+rules['match2_4']+", "+rules['match6_2']+")";
		rules['and11_3'] = "and("+rules['match6_1']+", "+rules['match6_2']+")";
		
		var qtiMatching = new QTIMatching ();
		qtiMatching.setVariables (variables);
		qtiMatching.setCorrects (corrects);
		qtiMatching.setOutcomes (outcomes);
	</script>
	
	<!-- -------------------------------------------------------------------------
	UNIT TESTS
	--------------------------------------------------------------------------->
	<script type="application/javascript">

		test("match single identifier", function() {
			qtiMatching.setRule (rules['match0_1']);
			equals(qtiMatching.evalResponseProcessing (), true, "Same single identifier <br/> \
				rule : "+ rules['match0_1'] +"<br/> \
				corrrect var : "+qtiMatching.getCorrect('RESPONSE0_1').toJson()+" <br/> \
				user var : "+qtiMatching.getVariable('RESPONSE0_1').toJson()+" <br/> \
			" );
			qtiMatching.setRule (rules['match0_2']);
			equals(qtiMatching.evalResponseProcessing (), false, "Value diff <br/> \
				rule : "+ rules['match0_2'] +"<br/> \
				corrrect var : "+qtiMatching.getCorrect('RESPONSE0_1').toJson()+" <br/> \
				user var : "+qtiMatching.getVariable('RESPONSE0_2').toJson()+" <br/> \
			" );
			qtiMatching.setRule (rules['match0_3']);
			equals(qtiMatching.evalResponseProcessing (), false, "Empty value <br/> \
				rule : "+ rules['match0_3'] +"<br/> \
				corrrect var : "+qtiMatching.getCorrect('RESPONSE0_1').toJson()+" <br/> \
				user var : "+qtiMatching.getVariable('RESPONSE0_3').toJson()+" <br/> \
			" );
		});
/*
		test("match multiple identifier", function() {
			equals( eval(rules['match1_1']), true, "Same multiple identifier <br/> \
				rule : "+ rules['match1_1'] +"<br/> \
				corrrect var : "+getCorrect('RESPONSE1_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE1_1').toJson()+" <br/> \
			" );
			equals( eval(rules['match1_2']), false, "A value of one identifier is diff <br/> \
				rule : "+ rules['match1_2'] +"<br/> \
				corrrect var : "+getCorrect('RESPONSE1_2').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE1_2').toJson()+" <br/> \
			" );
			equals( eval(rules['match1_3']), false, "Diff values length <br/> \
				rule : "+ rules['match1_3'] +"<br/> \
				corrrect var : "+getCorrect('RESPONSE1_3').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE1_3').toJson()+" <br/> \
			" );
			equals( eval(rules['match1_4']), false, "Diff values length <br/> \
				rule : "+ rules['match1_4'] +"<br/> \
				corrrect var : "+getCorrect('RESPONSE1_4').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE1_4').toJson()+" <br/> \
			" );
		});
		
		test("match single pair", function() {
			equals( eval(rules['match2_1']), true, "Same single pair <br/> \
				rule : "+ rules['match2_1'] +"<br/> \
				corrrect var : "+getCorrect('RESPONSE2_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE2_1').toJson()+" <br/> \
			" );
			equals( eval(rules['match2_2']), false, "Diff value <br/> \
				rule : "+ rules['match2_2'] +"<br/> \
				corrrect var : "+getCorrect('RESPONSE2_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE2_2').toJson()+" <br/> \
			" );
			equals( eval(rules['match2_3']), false, "Empty value <br/> \
				rule : "+ rules['match2_3'] +"<br/> \
				corrrect var : "+getCorrect('RESPONSE2_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE2_3').toJson()+" <br/> \
			" );
			equals( eval(rules['match2_4']), true, "Unordered pair <br/> \
				rule : "+ rules['match2_4'] +"<br/> \
				corrrect var : "+getCorrect('RESPONSE2_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE2_4').toJson()+" <br/> \
			" );
		});
		
		test("match multiple pair", function() {
			equals( eval(rules['match3_1']), true, "Same multiple pair <br/> \
				rule : "+ rules['match3_1'] +"<br/> \
				corrrect var : "+getCorrect('RESPONSE3_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE3_1').toJson()+" <br/> \
			" );
			equals( eval(rules['match3_2']), false, "A value of one pair is diff <br/> \
				rule : "+ rules['match3_2'] +"<br/> \
				corrrect var : "+getCorrect('RESPONSE3_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE3_2').toJson()+" <br/> \
			" );
			equals( eval(rules['match3_3']), false, "Diff values length <br/> \
				rule : "+ rules['match3_3'] +"<br/> \
				corrrect var : "+getCorrect('RESPONSE3_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE3_3').toJson()+" <br/> \
			" );
			equals( eval(rules['match3_4']), true, "Unordered pair <br/> \
				rule : "+ rules['match3_4'] +"<br/> \
				corrrect var : "+getCorrect('RESPONSE3_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE3_4').toJson()+" <br/> \
			" );
		});
		
		test("match multiple directedpair", function() {
			equals( eval(rules['match6_1']), false, "Same multiple directedpair <br/> \
				rule : "+ rules['match6_1'] +"<br/> \
				corrrect var : "+getCorrect('RESPONSE6_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE6_1').toJson()+" <br/> \
			" );
			equals( eval(rules['match6_2']), true, "Same multiple directedpair <br/> \
				rule : "+ rules['match6_2'] +"<br/> \
				corrrect var : "+getCorrect('RESPONSE6_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE6_2').toJson()+" <br/> \
			" );
		});
		
		test("match multiple boolean", function() {
			equals( eval(rules['match7_1']), true, "Same multiple boolean <br/> \
				rule : "+ rules['match7_1'] +"<br/> \
				corrrect var : "+getCorrect('RESPONSE7_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE7_1').toJson()+" <br/> \
			" );
		});
		
		test("match multiple integer", function() {
			equals( eval(rules['match8_1']), true, "Same multiple integer <br/> \
				rule : "+ rules['match8_1'] +"<br/> \
				corrrect var : "+getCorrect('RESPONSE8_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE8_1').toJson()+" <br/> \
			" );
		});
		
		test("match multiple float", function() {
			equals( eval(rules['match9_1']), true, "Same multiple float <br/> \
				rule : "+ rules['match9_1'] +"<br/> \
				corrrect var : "+getCorrect('RESPONSE9_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE9_1').toJson()+" <br/> \
			" );
		});
		
		test("match multiple string", function() {
			equals( eval(rules['match10_1']), true, "Same multiple string <br/> \
				rule : "+ rules['match10_1'] +"<br/> \
				corrrect var : "+getCorrect('RESPONSE10_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE10_1').toJson()+" <br/> \
			" );
		});
		
		test("match multiple 'diff' type", function() {
			equals( eval("match(getVariable('RESPONSE10_1'), getVariable('RESPONSE9_1'))"), false, "String Vs Float <br/> \
				rule : "+ rules['match10_1'] +"<br/> \
				var1 : "+getVariable('RESPONSE10_1').toJson()+" <br/> \
				var2 : "+getVariable('RESPONSE9_1').toJson()+" <br/> \
			" );
			equals( eval("match(getVariable('RESPONSE9_1'), getVariable('RESPONSE8_1'))"), false, "Float Vs Integer <br/> \
				rule : "+ rules['match10_1'] +"<br/> \
				var1 : "+getVariable('RESPONSE9_1').toJson()+" <br/> \
				var2 : "+getVariable('RESPONSE8_1').toJson()+" <br/> \
			" );
			equals( eval("match(getVariable('RESPONSE7_1'), getVariable('RESPONSE8_1'))"), false, "Integer Vs Boolean <br/> \
				rule : "+ rules['match10_1'] +"<br/> \
				var1 : "+getVariable('RESPONSE7_1').toJson()+" <br/> \
				var2 : "+getVariable('RESPONSE8_1').toJson()+" <br/> \
			" );
			equals( eval("match(getVariable('RESPONSE6_1'), getVariable('RESPONSE7_1'))"), false, "Boolean Vs Directedpair <br/> \
				rule : "+ rules['match10_1'] +"<br/> \
				var1 : "+getVariable('RESPONSE6_1').toJson()+" <br/> \
				var2 : "+getVariable('RESPONSE7_1').toJson()+" <br/> \
			" );
		});
		
		test("map multiple pair", function() {
			equals( eval(rules['map4_1']), 1.6, "Same multiple pair <br/> \
				rule : "+ rules['map4_1'] +"<br/> \
				map var : "+getMap('RESPONSE4_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE4_1').toJson()+" <br/> \
			" );
			equals( eval(rules['map4_2']), 1.6, "Reponse doublon <br/> \
				rule : "+ rules['map4_2'] +"<br/> \
				map var : "+getMap('RESPONSE4_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE4_2').toJson()+" <br/> \
			" );
			equals( eval(rules['map4_3']), 0, "Empty response <br/> \
				rule : "+ rules['map4_3'] +"<br/> \
				map var : "+getMap('RESPONSE4_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE4_3').toJson()+" <br/> \
			" );
			equals( eval(rules['map4_4']), 1.5, "Partial response <br/> \
				rule : "+ rules['map4_4'] +"<br/> \
				map var : "+getMap('RESPONSE4_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE4_4').toJson()+" <br/> \
			" );
			equals( eval(rules['map4_5']), 1.6, "Unordered same multiple pair <br/> \
				rule : "+ rules['map4_5'] +"<br/> \
				map var : "+getMap('RESPONSE4_1').toJson()+" <br/> \
				user var : "+getVariable('RESPONSE4_5').toJson()+" <br/> \
			" );
		});
		
		test("set outcome value", function() {
			eval(rules['setoutcome5_1']);
			var outcomeValue5_1 = getOutcomeValue('SCORE5_1');
			equals(outcomeValue5_1[0], 2, "Set an outcome value with the value 2<br/> \
				rule : "+ rules['setoutcome5_1'] +"<br/> \
				outcome var : "+getOutcome('SCORE5_1').toJson()+" <br/> \
			" );
			
			eval(rules['setoutcome5_2']);
			var outcomeValue5_2 = getOutcomeValue('SCORE5_2');
			equals(outcomeValue5_2[0], 1.6, "Set an outcome value with the result of a mapResponse expression (map4_5)<br/> \
				rule : "+ rules['setoutcome5_2'] +"<br/> \
				outcome var : "+getOutcome('SCORE5_2').toJson()+" <br/> \
			" );
		});
		
		test("and operator", function() {
			equals(eval(rules['and11_1']), true, "Compare two expressions with the and operator<br/> \
				rule : "+ rules['and11_1'] +"<br/> \
			" );
			equals(eval(rules['and11_2']), true, "Compare two match expressions (match2_4 Vs match6_2) with the and operator<br/> \
				rule : "+ rules['and11_2'] +"<br/> \
			" );
			equals(eval(rules['and11_3']), false, "Compare two match expressions (match6_1 Vs match6_2) with the and operator<br/> \
				rule : "+ rules['and11_3'] +"<br/> \
			" );
		});
		*/
	</script>
</head>
<body>
	<h1 id="qunit-header">QUnit Test Suite</h1>
	<h2 id="qunit-banner"></h2>
	<div id="qunit-testrunner-toolbar"></div>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>
	<div id="qunit-fixture">test markup</div>
</body>
</html>
