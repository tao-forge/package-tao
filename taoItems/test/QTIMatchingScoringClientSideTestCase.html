<!DOCTYPE html>
<html>
<head>
	<title>QUnit Test Suite</title>
	<link rel="stylesheet" href="../../tao/test/qunit/qunit.css" type="text/css" media="screen">
	<script type="text/javascript" src="https://getfirebug.com/firebug-lite.js"></script>
	<script type="application/javascript" src='http://waterphoenix.local/lib/jquery/jquery-1.4.2.min.js'></script>
	<script type="application/javascript" src="../../tao/test/qunit/qunit.js"></script>
	<script type="application/javascript" src="../views/js/taoMatching/src/class.Matching.js"></script>
	<script type="application/javascript" src="../views/js/taoMatching/src/class.VariableFactory.js"></script>
	<script type="application/javascript" src="../views/js/taoMatching/src/class.Variable.js"></script>
	<script type="application/javascript" src="../views/js/taoMatching/src/class.BaseTypeVariable.js"></script>
	<script type="application/javascript" src="../views/js/taoMatching/src/class.Collection.js"></script>
	<script type="application/javascript" src="../views/js/taoMatching/src/class.List.js"></script>
	<script type="application/javascript" src="../views/js/taoMatching/src/class.Tuple.js"></script>
	<script type="application/javascript" src="../views/js/taoMatching/src/class.Map.js"></script>
	<script type="application/javascript" src="../views/js/taoMatching/src/matching_api.js"></script>
	
	<!-- -------------------------------------------------------------------------
	QTI DATA
	--------------------------------------------------------------------------->
	<script type="application/javascript">
		
			test("Test the VariableFactory (integer)", function() {
			var int1 = TAO_MATCHING.VariableFactory.create (1);
			var int2 = TAO_MATCHING.VariableFactory.create (2);
			var nullVar = TAO_MATCHING.VariableFactory.create (null);
			ok (int1 != null, 'Variable not null');
			equals (int1.getType(), 'number', 'Right type');
			equals (int1.getValue(), 1, 'Right value');
			ok (int1.match(int1), 'Match itself');
			ok (!int1.match(int2), 'Does not match a different integer variable');
			ok (int1.equal(int1), 'It is equal to itself');
			ok (!int1.equal(int2), 'It is not equal to a different integer variable');
			ok (!int1.equal(nullVar), 'It is not equal to a null variable');
		});
		
		test("Test the VariableFactory (float)", function() {
			var dbl1 = TAO_MATCHING.VariableFactory.create (3.14);
			var dbl2 = TAO_MATCHING.VariableFactory.create (3.0);
			var nullVar = TAO_MATCHING.VariableFactory.create (null);
			ok (dbl1 != null, 'Variable not null');
			equals (dbl1.getType(), 'number', 'Right type');
			equals (dbl1.getValue(), 3.14, 'Right value');
			ok (dbl1.match(dbl1), 'Match itself');
			ok (!dbl1.match(dbl2), 'Does not match a different float variable');
			ok (dbl1.equal(dbl1), 'It is equal to itself');
			ok (!dbl1.equal(dbl2), 'It is not equal to a different float variable');
			ok (!dbl1.equal(nullVar), 'It is not equal to a null variable');
		});
		
		test("Test the VariableFactory (boolean)", function() {
			var bool1 = TAO_MATCHING.VariableFactory.create (3.14);
			var bool2 = TAO_MATCHING.VariableFactory.create (3.0);
			var nullVar = TAO_MATCHING.VariableFactory.create (null);
			ok (bool1 != null, 'Variable not null');
			equals (bool1.getType(), 'number', 'Right type');
			equals (bool1.getValue(), 3.14, 'Right value');
			ok (bool1.match(bool1), 'Match itself');
			ok (!bool1.match(bool2), 'Does not match a different boolean variable');
			ok (bool1.equal(bool1), 'It is equal to itself');
			ok (!bool1.equal(bool2), 'It is not equal to a different boolean variable');
			ok (!bool1.equal(nullVar), 'It is not equal to a null variable');
		});
		
		test("Test the VariableFactory (string)", function() {
			var str1 = TAO_MATCHING.VariableFactory.create ('TAO');
			var str2 = TAO_MATCHING.VariableFactory.create ('it\'s so powerfull');
			var nullVar = TAO_MATCHING.VariableFactory.create (null);
			ok (str1 != null, 'Variable not null');
			equals (str1.getType(), 'string', 'Right type');
			equals (str1.getValue(), 'TAO', 'Right value');
			ok (str1.match(str1), 'Match itself');
			ok (!str1.match(str2), 'Does not match a different string variable');
			ok (str1.equal(str1), 'It is equal to itself');
			ok (!str1.equal(str2), 'It is not equal to a different string variable');
			ok (!str1.equal(nullVar), 'It is not equal to a null variable');
		});
		
		test("Test the VariableFactory (list [in QTI Pair])", function() {
			var list1 = TAO_MATCHING.VariableFactory.create (["TAO", "Test Assisté par Ordinateur"]);
			var list2 = TAO_MATCHING.VariableFactory.create (["CBA", "Computer Based Assessment"]);
			var list3 = TAO_MATCHING.VariableFactory.create (["CBA"]);
			var list4 = TAO_MATCHING.VariableFactory.create (["CBA", "Computer Based Assessment", "yeah"]);
			var list5 = TAO_MATCHING.VariableFactory.create ([]);
			var varNull = TAO_MATCHING.VariableFactory.create (null);
			ok (list1 != null, 'Variable not null');
			equals (list1.getType(), 'list', 'Right type');
			var tmpValue = list1.getValue();
			equals (tmpValue[0].getValue(),  'TAO', 'Right value');
			equals (tmpValue[1].getValue(), 'Test Assisté par Ordinateur', 'Right value');
			ok (list1.match(list1), 'Match itself');
			ok (!list1.match(list2), 'Does not match a different list');
			ok (!list1.match(list3), 'Does not match a different list');
			ok (!list1.match(list4), 'Does not match a different list');
			ok (!list1.match(list5), 'Does not match a different list');
		});
		
		test("Test the VariableFactory (tuple [in QTI DirectedPair])", function() {
			var tuple1 = TAO_MATCHING.VariableFactory.create ({"0":"TAO", "1":"it\'s so powerfull"});
			var tuple2 = TAO_MATCHING.VariableFactory.create ({"0":"Yeahhh", "1":"it\'s true"});
			var tuple3 = TAO_MATCHING.VariableFactory.create ({"0":"TAO"});
			var tuple4 = TAO_MATCHING.VariableFactory.create ({"0":"TAO", "1":"it\'s so powerfull", "2":"yeah"});
			ok (tuple1 != null, 'Variable not null');
			equals (tuple1.getType(), 'tuple', 'Right type');
			var tmpValue = tuple1.getValue ();
			equals (tmpValue[0].getValue(), 'TAO', 'Right value');
			equals (tmpValue[1].getValue(), 'it\'s so powerfull', 'Right value');
			ok (tuple1.match(tuple1), 'Match itself');
			ok (!tuple1.match(tuple2), 'Does not match a different tuple');
			ok (!tuple1.match(tuple3), 'Does not match a different tuple');
			ok (!tuple1.match(tuple4), 'Does not match a different tuple');
		});
		
		test("Test the VariableFactory (list of list [in QTI Multiple Pair])", function() {
			var listList1 = TAO_MATCHING.VariableFactory.create ([["A", "B"], ["C", "D"], ["E", "F"]]);
			var listList2 = TAO_MATCHING.VariableFactory.create ([["B", "A"], ["D", "C"], ["F", "E"]]);
			var listList3 = TAO_MATCHING.VariableFactory.create ([["A", "B"], ["C", "D"]]);
			var listList4 = TAO_MATCHING.VariableFactory.create ([["A", "B"], ["C", "D"], ["E", "F"], ["G", "H"]]);
			var listList5 = TAO_MATCHING.VariableFactory.create ([]);
			var listList6 = TAO_MATCHING.VariableFactory.create ([["A", "B"], ["C", "D"], ["E", "F"], ["A", "B"], ["C", "D"], ["E", "F"]]);
			ok (listList1 != null, 'Variable not null');
			equals (listList1.getType(), 'list', 'Right type');
			ok (listList1.match(listList1), 'Match itself');
			ok (listList1.match(listList2), 'Match a different list with the same content but inversed');
			ok (!listList1.match(listList3), 'Does not match a different list');
			ok (!listList1.match(listList4), 'Does not match a different list');
			ok (!listList1.match(listList5), 'Does not match a different list');
		});
		
		test("Test the VariableFactory (list of tuple [in QTI Multiple DirectedPair])", function() {
			var listTuple1 = TAO_MATCHING.VariableFactory.create ([{"0":"A", "1":"B"}, {"0":"C", "1":"D"}, {"0":"E", "1":"F"}]);
			var listTuple2 = TAO_MATCHING.VariableFactory.create ([{"0":"B", "1":"A"}, {"0":"D", "1":"C"}, {"0":"F", "1":"E"}]);
			var listTuple3 = TAO_MATCHING.VariableFactory.create ([{"0":"A", "1":"B"}, {"0":"C", "1":"D"}]);
			var listTuple4 = TAO_MATCHING.VariableFactory.create ([{"0":"A", "1":"B"}, {"0":"C", "1":"D"}, {"0":"E", "1":"F"}, {"0":"G", "1":"H"}]);
			var listTuple5 = TAO_MATCHING.VariableFactory.create ([]);
			var listTuple6 = TAO_MATCHING.VariableFactory.create ([{"0":"A", "1":"B"}, {"0":"C", "1":"D"}, {"0":"E", "1":"F"}, {"0":"A", "1":"B"}, {"0":"C", "1":"D"}, {"0":"E", "1":"F"}]);
			ok (listTuple1 != null, 'Variable not null');
			equals (listTuple1.getType(), 'list', 'Right type');
			ok (listTuple1.match(listTuple1), 'Match itself');
			ok (!listTuple1.match(listTuple2), 'Does not match a different listTuple');
			ok (!listTuple1.match(listTuple3), 'Does not match a different listTuple');
			ok (!listTuple1.match(listTuple4), 'Does not match a different listTuple');
			ok (!listTuple1.match(listTuple5), 'Does not match a different listTuple');
		});
		
		test("map list of list [in QTI list of pair]", function() {
			var map1 = new TAO_MATCHING.Map ([{"key":["A", "B"], "value":1}, {"key":["C", "D"], "value":0.5}, {"key":["E", "F"], "value":0.2}]);
			var listList1 = TAO_MATCHING.VariableFactory.create ([["A", "B"], ["C", "D"], ["E", "F"]]);
			var listList2 = TAO_MATCHING.VariableFactory.create ([["B", "A"], ["D", "C"], ["F", "E"]]);
			var listList3 = TAO_MATCHING.VariableFactory.create ([["A", "B"], ["C", "D"]]);
			var listList4 = TAO_MATCHING.VariableFactory.create ([["A", "B"], ["C", "D"], ["E", "F"], ["G", "H"]]);
			var listList5 = TAO_MATCHING.VariableFactory.create ([]);
			var listList6 = TAO_MATCHING.VariableFactory.create ([["A", "B"], ["C", "D"], ["E", "F"], ["A", "B"], ["C", "D"], ["E", "F"]]);
			equals (map1.map(listList1), 1.7, 'Right mapping');
			equals (map1.map(listList2), 1.7, 'Right mapping');
			equals (map1.map(listList3), 1.5, 'Right mapping');
			equals (map1.map(listList4), 1.7, 'Right mapping');
			equals (map1.map(listList5), 0.0, 'Right mapping');
			equals (map1.map(listList6), 1.7, 'Right mapping');
		});
		
		test("map list of tuple [in QTI list of directedpair]", function() {
			var map2 = new TAO_MATCHING.Map ([{"key":{"0":"A", "1":"B"}, "value":1}, {"key":{"0":"C", "1":"D"}, "value":0.5}, {"key":{"0":"E", "1":"F"}, "value":0.2}]);
			var listTuple1 = TAO_MATCHING.VariableFactory.create ([{"0":"A", "1":"B"}, {"0":"C", "1":"D"}, {"0":"E", "1":"F"}]);
			var listTuple2 = TAO_MATCHING.VariableFactory.create ([{"0":"B", "1":"A"}, {"0":"D", "1":"C"}, {"0":"F", "1":"E"}]);
			var listTuple3 = TAO_MATCHING.VariableFactory.create ([{"0":"A", "1":"B"}, {"0":"C", "1":"D"}]);
			var listTuple4 = TAO_MATCHING.VariableFactory.create ([{"0":"A", "1":"B"}, {"0":"C", "1":"D"}, {"0":"E", "1":"F"}, {"0":"G", "1":"H"}]);
			var listTuple5 = TAO_MATCHING.VariableFactory.create ([]);
			var listTuple6 = TAO_MATCHING.VariableFactory.create ([{"0":"A", "1":"B"}, {"0":"C", "1":"D"}, {"0":"E", "1":"F"}, {"0":"A", "1":"B"}, {"0":"C", "1":"D"}, {"0":"E", "1":"F"}]);
			equals (map2.map(listTuple1), 1.7, 'Right mapping');
			equals (map2.map(listTuple2), 0.0, 'Right mapping');
			equals (map2.map(listTuple3), 1.5, 'Right mapping');
			equals (map2.map(listTuple4), 1.7, 'Right mapping');
			equals (map2.map(listTuple5), 0.0, 'Right mapping');
			equals (map2.map(listTuple6), 1.7, 'Right mapping');
		});
	
		test("template response processing match_correct", function() {
			matching_init ({"mode":"client"});
			matching_setRule ("if(match(getResponse('RESPONSE'), getCorrect('RESPONSE'))) setOutcomeValue('SCORE', 1); else setOutcomeValue('SCORE', 0);");
			matching_setCorrects ([{"identifier":"RESPONSE", "value":"1"}]);
			matching_setResponses ([{"identifier":"RESPONSE", "value":"1"}]);
			matching_setOutcomes ([{"identifier":"SCORE", "type":"double"}]);
			matching_evaluate ();
			outcomes = matching_getOutcomes ();
			equals (outcomes["SCORE"]["value"], 1);
			
			matching_init ({"mode":"client"});
			matching_setRule ("if(match(getResponse('RESPONSE'), getCorrect('RESPONSE'))) setOutcomeValue('SCORE', 1); else setOutcomeValue('SCORE', 0);");
			matching_setCorrects ([{"identifier":"RESPONSE", "value":[{"0":"A", "1":"B"}, {"0":"C", "1":"D"}, {"0":"E", "1":"F"}]}]);
			matching_setResponses ([{"identifier":"RESPONSE", "value":[{"0":"A", "1":"B"}, {"0":"C", "1":"D"}, {"0":"E", "1":"F"}]}]);
			matching_setOutcomes ([{"identifier":"SCORE", "type":"double"}]);
			matching_evaluate ();
			outcomes = matching_getOutcomes ();
			equals (outcomes["SCORE"]["value"], 1);
		});

		test("template response processing mapResponse", function() {
			// string
			matching_init ({"mode":"client"});
			matching_setRule ("if (isNull(getResponse('RESPONSE'))) { setOutcomeValue('SCORE', 0); } else { setOutcomeValue('SCORE', mapResponse(getMap('RESPONSE'), getResponse('RESPONSE'))); }");
			matching_setCorrects ([{"identifier":"RESPONSE", "value":"Paris"}]);
			matching_setResponses ([{"identifier":"RESPONSE", "value":"paris"}]);
			matching_setMaps ([{"identifier":"RESPONSE", "value":[{"key":"Paris", "value":1}, {"key":"paris", "value":0.9}]}]);
			matching_setOutcomes ([{"identifier":"SCORE", "type":"double"}]);
			matching_evaluate ();
			outcomes = matching_getOutcomes ();
			equals (outcomes["SCORE"]["value"], 0.9);
			
			// list list (multiple pair)
			matching_init ({"mode":"client"});
			matching_setRule ("if (isNull(getResponse('RESPONSE'))) { setOutcomeValue('SCORE', 0); } else { setOutcomeValue('SCORE', mapResponse(getMap('RESPONSE'), getResponse('RESPONSE'))); }");
			matching_setCorrects ([{"identifier":"RESPONSE", "value":[["A", "B"], ["C", "D"], ["E", "F"]]}]);
			matching_setResponses ([{"identifier":"RESPONSE", "value":[["A", "B"], ["C", "D"], ["E", "F"]]}]);
			matching_setMaps ([{"identifier":"RESPONSE", "value":[{"key":["A", "B"], "value":1}, {"key":["C", "D"], "value":0.5}, {"key":["E", "F"], "value":0.2}]}]);
			matching_setOutcomes ([{"identifier":"SCORE", "type":"double"}]);
			matching_evaluate ();
			outcomes = matching_getOutcomes ();
			equals (outcomes["SCORE"]["value"], 1.7);
			
			// list list (multiple pair but with reversed result)
			matching_init ({"mode":"client"});
			matching_setRule ("if (isNull(getResponse('RESPONSE'))) { setOutcomeValue('SCORE', 0); } else { setOutcomeValue('SCORE', mapResponse(getMap('RESPONSE'), getResponse('RESPONSE'))); }");
			matching_setCorrects ([{"identifier":"RESPONSE", "value":[["A", "B"], ["C", "D"], ["E", "F"]]}]);
			matching_setResponses ([{"identifier":"RESPONSE", "value":[["B", "A"], ["D", "C"], ["F", "E"]]}]);
			matching_setMaps ([{"identifier":"RESPONSE", "value":[{"key":["A", "B"], "value":1}, {"key":["C", "D"], "value":0.5}, {"key":["E", "F"], "value":0.2}]}]);
			matching_setOutcomes ([{"identifier":"SCORE", "type":"double"}]);
			matching_evaluate ();
			outcomes = matching_getOutcomes ();
			equals (outcomes["SCORE"]["value"], 1.7);
			
			// list tuple (multiple directedpair)
			matching_init ({"mode":"client"});
			matching_setRule ("if (isNull(getResponse('RESPONSE'))) { setOutcomeValue('SCORE', 0); } else { setOutcomeValue('SCORE', mapResponse(getMap('RESPONSE'), getResponse('RESPONSE'))); }");
			matching_setCorrects ([{"identifier":"RESPONSE", "value":[{"0":"A", "1":"B"}, {"0":"C", "1":"D"}, {"0":"E", "1":"F"}]}]);
			matching_setResponses ([{"identifier":"RESPONSE", "value":[{"0":"A", "1":"B"}, {"0":"C", "1":"D"}, {"0":"E", "1":"F"}]}]);
			matching_setMaps ([{"identifier":"RESPONSE", "value":[{"key":{"0":"A", "1":"B"}, "value":1}, {"key":{"0":"C", "1":"D"}, "value":0.5}, {"key":{"0":"E", "1":"F"}, "value":0.2}]}]);
			matching_setOutcomes ([{"identifier":"SCORE", "type":"double"}]);
			matching_evaluate ();
			$outcomes = matching_getOutcomes ();
			equals (outcomes["SCORE"]["value"], 1.7);
	
			// list tuple (multiple directedpair reversed pair)
			matching_init ({"mode":"client"});
			matching_setRule ("if (isNull(getResponse('RESPONSE'))) { setOutcomeValue('SCORE', 0); } else { setOutcomeValue('SCORE', mapResponse(getMap('RESPONSE'), getResponse('RESPONSE'))); }");
			matching_setCorrects ([{"identifier":"RESPONSE", "value":[{"0":"A", "1":"B"}, {"0":"C", "1":"D"}, {"0":"E", "1":"F"}]}]);
			matching_setResponses ([{"identifier":"RESPONSE", "value":[{"0":"B", "1":"A"}, {"0":"D", "1":"C"}, {"0":"F", "1":"E"}]}]);
			matching_setMaps ([{"identifier":"RESPONSE", "value":[{"key":{"0":"A", "1":"B"}, "value":1}, {"key":{"0":"C", "1":"D"}, "value":0.5}, {"key":{"0":"E", "1":"F"}, "value":0.2}]}]);
			matching_setOutcomes ([{"identifier":"SCORE", "type":"double"}]);
			matching_evaluate ();
			outcomes = matching_getOutcomes ();
			equals (outcomes["SCORE"]["value"], 0);
		});

	</script>
	
</head>
<body>
	<h1 id="qunit-header">QUnit Test Suite</h1>
	<h2 id="qunit-banner"></h2>
	<div id="qunit-testrunner-toolbar"></div>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>
	<div id="qunit-fixture">test markup</div>
</body>
</html>
